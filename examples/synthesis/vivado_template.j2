# === USER CONFIGURATION ===
set proj_name "{{ name }}"
set proj_dir "./vivado_project"
set top_module "{{ top }}"
set part "{{ target }}"
set filelist "{{ cmdfile }}"

# === PROJECT SETUP ===
create_project $proj_name $proj_dir -part $part -force

# === READ CMD FILE ===
set fp [open $filelist r]
while {[gets $fp line] >= 0} {
    set line [string trim $line]
    if {[string match "#*" $line] || $line eq ""} {
        continue ;# Skip comments and empty lines
    } elseif {[string match "-I*" $line]} {
        set incdir [string range $line 2 end]
        set_property include_dirs [concat $incdir] [current_fileset]
    } elseif {[file exists $line]} {
        add_files $line
    } else {
        puts "Warning: Skipping unknown or missing entry: $line"
    }
}
close $fp

# === SET TOP ===
set_property top $top_module [current_fileset]

# === SYNTHESIS ===
launch_runs synth_1
wait_on_run synth_1
open_run synth_1

# === REPORTING ===
# TODO: Xilinx keeps breaking these, fix for latest version
report_utilization -file "${top_module}_util.rpt"
report_timing_summary -file "${top_module}_timing.rpt"
